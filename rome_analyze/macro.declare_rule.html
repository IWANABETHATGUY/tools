<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This macro is used to declare an analyzer rule type, and implement the [RuleMeta] trait for it"><meta name="keywords" content="rust, rustlang, rust-lang, declare_rule"><title>declare_rule in rome_analyze - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="sidebar-items.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc macro"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../rome_analyze/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../rome_analyze/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><div class="sidebar-elems"><h2 class="location"><a href="index.html">In rome_analyze</a></h2></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../rome_analyze/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Macro <a href="index.html">rome_analyze</a>::<wbr><a class="macro" href="#">declare_rule</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/rome_analyze/rule.rs.html#174-198">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><div class="example-wrap"><pre class="rust macro"><code><span class="macro">macro_rules!</span> <span class="ident">declare_rule</span> {
    ( $( <span class="attribute">#[<span class="ident">doc</span> <span class="op">=</span> <span class="macro-nonterminal">$</span><span class="macro-nonterminal">doc</span>:<span class="ident">literal</span>]</span> )<span class="op">+</span> <span class="macro-nonterminal">$</span><span class="macro-nonterminal">vis</span>:<span class="ident">vis</span> <span class="macro-nonterminal">$</span><span class="macro-nonterminal">id</span>:<span class="ident">ident</span> {
        <span class="ident">version</span>: <span class="macro-nonterminal">$</span><span class="macro-nonterminal">version</span>:<span class="ident">literal</span>,
        <span class="ident">name</span>: <span class="macro-nonterminal">$</span><span class="macro-nonterminal">name</span>:<span class="ident">tt</span>,
        $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">key</span>:<span class="ident">ident</span>: <span class="macro-nonterminal">$</span><span class="macro-nonterminal">value</span>:<span class="ident">expr</span>, )<span class="op">*</span>
    } ) =&gt; { ... };
}</code></pre></div>
</div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This macro is used to declare an analyzer rule type, and implement the
<a href="trait.RuleMeta.html" title="RuleMeta">RuleMeta</a> trait for it</p>
<h2 id="example"><a href="#example">Example</a></h2>
<p>The macro itself expect the following syntax:</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="macro">declare_rule!</span> {
    <span class="doccomment">/// Documentation</span>
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="ident">ExampleRule</span> {
        <span class="ident">version</span>: <span class="string">&quot;0.7.0&quot;</span>,
        <span class="ident">name</span>: <span class="string">&quot;ruleName&quot;</span>
    }
}</code></pre></div>
<h2 id="documentation"><a href="#documentation">Documentation</a></h2>
<p>The doc-comment for the rule is mandatory and is used to generate the
documentation page for the rule on the website.</p>
<p>Importantly, the tool used to generate those pages also runs tests on the
code blocks included in the documentation written in languages supported by
the Rome toolchain (JavaScript, JSX, TypeScript, …) similar to how
<code>rustdoc</code> generates tests from code blocks written in Rust. Because code
blocks in Rust doc-comments are assumed to be written in Rust by default
the language of the test must be explicitly specified, for instance:</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="macro">declare_rule!</span> {
    <span class="doccomment">/// Disallow the use of `var`</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ### Valid</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ```js</span>
    <span class="doccomment">/// let a, b;</span>
    <span class="doccomment">/// ```</span>
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="ident">NoVar</span> {
        <span class="ident">version</span>: <span class="string">&quot;0.7.0&quot;</span>,
        <span class="ident">name</span>: <span class="string">&quot;noVar&quot;</span>
    }
}</code></pre></div>
<p>Additionally, it’s possible to declare that a test should emit a diagnostic
by adding <code>expect_diagnostic</code> to the language metadata:</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="macro">declare_rule!</span> {
    <span class="doccomment">/// Disallow the use of `var`</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ### Invalid</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ```js,expect_diagnostic</span>
    <span class="doccomment">/// var a, b;</span>
    <span class="doccomment">/// ```</span>
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="ident">NoVar</span> {
        <span class="ident">version</span>: <span class="string">&quot;0.7.0&quot;</span>,
        <span class="ident">name</span>: <span class="string">&quot;noVar&quot;</span>
    }
}</code></pre></div>
<p>This will cause the documentation generator to ensure the rule does emit
exactly one diagnostic for this code, and to include a snapshot for the
diagnostic in the resulting documentation page</p>
<h3 id="deprecation"><a href="#deprecation">Deprecation</a></h3>
<p>There are occasions when a rule must be deprecated, to avoid breaking changes. The reason
of deprecations can be multiples.</p>
<p>In order to to do, the macro allows to add additional field to add the reason for deprecation</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="macro">declare_rule!</span> {
    <span class="doccomment">/// Disallow the use of `var`</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ### Invalid</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ```js,expect_diagnostic</span>
    <span class="doccomment">/// var a, b;</span>
    <span class="doccomment">/// ```</span>
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="ident">NoVar</span> {
        <span class="ident">version</span>: <span class="string">&quot;0.7.0&quot;</span>,
        <span class="ident">name</span>: <span class="string">&quot;noVar&quot;</span>,
        <span class="ident">deprecated</span>: <span class="string">&quot;Use the rule `noAnotherVar`&quot;</span>
    }
}</code></pre></div>
<h3 id="category-macro"><a href="#category-macro">Category Macro</a></h3>
<p>Declaring a rule using <code>declare_rule!</code> will cause a new <code>rule_category!</code>
macro to be declared in the surrounding module. This macro can be used to
refer to the corresponding diagnostic category for this lint rule, if it
has one. Using this macro instead of getting the category for a diagnostic
by dynamically parsing its string name has the advantage of statically
injecting the category at compile time and checking that it is correctly
registered to the <code>rome_diagnostics</code> library</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="macro">declare_rule!</span> {
    <span class="doccomment">/// Documentation</span>
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="ident">ExampleRule</span> {
        <span class="ident">version</span>: <span class="string">&quot;0.7.0&quot;</span>,
        <span class="ident">name</span>: <span class="string">&quot;ruleName&quot;</span>
    }
}

<span class="kw">impl</span> <span class="ident">Rule</span> <span class="kw">for</span> <span class="ident">ExampleRule</span> {
    <span class="kw">fn</span> <span class="ident">diagnostic</span>(<span class="ident">ctx</span>: <span class="kw-2">&amp;</span><span class="ident">RuleContext</span><span class="op">&lt;</span><span class="self">Self</span><span class="op">&gt;</span>, <span class="ident">_state</span>: <span class="kw-2">&amp;</span><span class="ident"><span class="self">Self</span>::State</span>) -&gt; <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">RuleDiagnostic</span><span class="op">&gt;</span> {
        <span class="prelude-val">Some</span>(<span class="ident">RuleDiagnostic::new</span>(
            <span class="macro">rule_category!</span>(),
            <span class="ident">ctx</span>.<span class="ident">query</span>().<span class="ident">text_trimmed_range</span>(),
            <span class="string">&quot;message&quot;</span>,
        ))
    }
}</code></pre></div>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="rome_analyze" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0 (a55dd71d5 2022-09-19)" ></div></body></html>